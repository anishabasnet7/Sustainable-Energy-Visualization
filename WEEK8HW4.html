<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sales Heatmap</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body { font-family: sans-serif; }
  .row-label, .col-label { cursor: default; }
  rect { cursor: pointer; }
</style>
</head>

<body>
<script>
const margin = { top: 50, right: 20, bottom: 20, left: 70 },
    width = 600 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;
const svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);
d3.csv("sales.csv").then(data => {
    //numeric
    data.forEach(d => d.Sales = +d.Sales);
    const products = Array.from(new Set(data.map(d => d.Product)));
    const days = Array.from(new Set(data.map(d => d.Day)));
    const x = d3.scaleBand()
        .domain(days)
        .range([0, width])
        .padding(0.05);
    const y = d3.scaleBand()
        .domain(products)
        .range([0, height])
        .padding(0.05);
    const color = d3.scaleSequential(d3.interpolateBlues)
        .domain([0, d3.max(data, d => d.Sales)]);
    //task1: heatmap
    const cells = svg.selectAll()
        .data(data)
        .join("g")
        .attr("transform", d => `translate(${x(d.Day)},${y(d.Product)})`);
    cells.append("rect")
        .attr("width", x.bandwidth())
        .attr("height", y.bandwidth())
        .attr("fill", d => color(d.Sales))
        .attr("stroke", "#ccc");
    cells.append("text")
        .attr("x", x.bandwidth()/2)
        .attr("y", y.bandwidth()/2)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "middle")
        .text(d => d.Sales);
    //column label
    svg.append("g")
        .selectAll("text")
        .data(days)
        .join("text")
        .attr("x", d => x(d) + x.bandwidth()/2)
        .attr("y", -10)
        .attr("text-anchor", "middle")
        .text(d => d)
        .attr("class", "col-label");
    svg.append("text")
        .attr("x", width / 2) //center of the heatmap
        .attr("y", -30) //above the day label
        .attr("text-anchor", "middle")
        .attr("font-weight", "bold")
        .text("Day");
    //row label
    svg.append("g")
        .selectAll("text")
        .data(products)
        .join("text")
        .attr("x", -10)
        .attr("y", d => y(d) + y.bandwidth()/2)
        .attr("text-anchor", "end")
        .attr("alignment-baseline", "middle")
        .text(d => d)
        .attr("class", "row-label");
    //task2: hover reactivity
    cells.on("mouseover", function(event, d) {
        svg.selectAll(".col-label")
            .filter(label => label === d.Day)
            .attr("font-weight", "bold")
            .attr("fill", "red");
        svg.selectAll(".row-label")
            .filter(label => label === d.Product)
            .attr("font-weight", "bold")
            .attr("fill", "red");
        })
        .on("mouseout", function(event, d) {
            svg.selectAll(".col-label, .row-label")
            .attr("font-weight", "normal")
            .attr("fill", "black");
        });
    //task3: when click--show difference
    let clicked = null;
    cells.on("click", function(event, d) {
        clicked = clicked === d ? null : d;
        const maxVal = d3.max(data, d => d.Sales);
        const diffScale = d3.scaleDiverging(d3.interpolateRdBu)
            .domain([-maxVal, 0, maxVal]);
        cells.select("rect")
            .transition()
            .duration(500)
            .attr("fill", cell => clicked ? diffScale(cell.Sales - clicked.Sales) : color(cell.Sales));
        cells.select("text")
            .text(cell => clicked ? (cell.Sales - clicked.Sales) : cell.Sales);
        });
    });
</script>
</body>
</html>


<!--Acknowledgment: This is assisted by an AI assistant, which provided the guidance only.-->